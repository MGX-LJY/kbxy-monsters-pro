# server/app/routes/health.py

## 概述
健康检查和系统统计接口的路由定义，提供系统状态监控和数据统计功能。

## 接口定义

### GET /health
**功能**: 系统健康检查接口
**返回信息**:
- **ok**: 系统状态标识（布尔值）
- **versions**: 版本信息
  - `python`: Python版本号
  - `fastapi`: FastAPI版本（0.112）
  - `sqlalchemy`: SQLAlchemy版本（2.x）
- **db_path**: 数据库文件路径
- **engine_version**: 规则引擎版本（rules-2025.08.01）
- **counts**: 基本数据统计
  - `monsters`: 怪物总数
  - `tags`: 标签总数

### GET /stats  
**功能**: 详细统计信息接口（用于前端总数显示）
**返回信息**:
- **total**: 怪物总数量
- **with_skills**: 拥有技能的怪物数量
- **tags_total**: 标签总数量

## 技术实现

### 数据库查询
- **连接管理**: 使用SessionLocal创建数据库会话
- **计数查询**: 直接使用SQLAlchemy的count()方法
- **关联查询**: 使用distinct()统计有技能的唯一怪物数

### 依赖模块
- `Monster`: 怪物数据模型
- `Tag`: 标签数据模型  
- `MonsterSkill`: 怪物技能关联模型
- `platform`: 系统平台信息获取
- `func`: SQLAlchemy函数工具

## 使用场景

### 系统监控
- **健康检查**: 监控系统运行状态
- **版本追踪**: 记录各组件版本信息
- **数据概览**: 快速了解数据规模

### 前端集成
- **统计显示**: 为前端提供实时统计数据
- **状态同步**: 保证前端显示数据的准确性
- **性能优化**: 避免前端复杂查询

## 更新历史
- 新增`/stats`接口解决前端总数显示空白问题
- 优化统计查询性能，使用数据库级别的聚合函数
- 支持有技能怪物的准确计数（使用DISTINCT避免重复计算）

这个模块为系统提供了重要的监控和统计功能，是前端数据展示的基础设施。